# React Hook çš„å†å²

## Hook çš„å‘å±•å†ç¨‹

React å›¢é˜Ÿä»ä¸€å¼€å§‹å°±å¾ˆæ³¨é‡ React çš„ä»£ç å¤ç”¨æ€§

ä»–ä»¬å¯¹ä»£ç å¤ç”¨æ€§çš„è§£å†³æ–¹æ¡ˆå†ç»ï¼šMixin, HOC, Render Propï¼Œç›´åˆ°ç°åœ¨çš„ Custom Hook

æ‰€ä»¥ Custom Hook å¹¶ä¸æ˜¯ä¸€æ‹è„‘é—¨æ¨ªç©ºå‡ºä¸–çš„äº§ç‰©ï¼Œå³ä½¿æ˜¯å¾ˆå¤šå¯¹ Custom Hook æœ‰ä¸°å¯Œå¼€å‘ç»éªŒçš„å¼€å‘è€…ï¼Œä¹Ÿä¸äº†è§£ Hook åˆ°åº•æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä»¥åŠåœ¨ React é‡Œæ‰®æ¼”ä»€ä¹ˆè§’è‰²

ä¸ç†è§£è¿™æ®µè®¾è®¡æ€è·¯æ˜¯æ— æ³•æ·±åˆ»çš„ç†è§£ Custom Hook çš„ï¼Œä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·æ¥å­¦ä¹ ä¸€ä¸‹

### 1. Mixin ğŸ’Š

```jsx
var SetIntervalMixin = {
  componentWillMount: function() {
    this.intervals = [];
  },
  setInterval: function() {
    this.intervals.push(setInterval.apply(null, arguments));
  },
  componentWillUnmount: function() {
    this.intervals.forEach(clearInterval);
  }
};

var createReactClass = require('create-react-class');

var TickTock = createReactClass({
  mixins: [SetIntervalMixin], // ä½¿ç”¨ mixin
  getInitialState: function() {
    return {seconds: 0};
  },
  componentDidMount: function() {
    this.setInterval(this.tick, 1000); // è°ƒç”¨ mixin ä¸Šçš„æ–¹æ³•
  },
  tick: function() {
    this.setState({seconds: this.state.seconds + 1});
  },
  render: function() {
    return (
      <p>
        React has been running for {this.state.seconds} seconds.
      </p>
    );
  }
});

ReactDOM.render(
  <TickTock />,
  document.getElementById('example')
);

```

ä¼˜ç‚¹ï¼š

1. ç¡®å®èµ·åˆ°äº†é‡ç”¨ä»£ç çš„ä½œç”¨

ç¼ºç‚¹ï¼š

1. å®ƒæ˜¯éšå¼ä¾èµ–ï¼Œéšå¼ä¾èµ–è¢«è®¤ä¸ºåœ¨ React ä¸­æ˜¯ä¸å¥½çš„

2. åå­—å†²çªé—®é¢˜

3. åªèƒ½åœ¨ React.createClassé‡Œå·¥ä½œï¼Œä¸æ”¯æŒ ES6 çš„ Class Component

4. å®è·µä¸‹æ¥å‘ç°ï¼šéš¾ä»¥ç»´æŠ¤

åœ¨ React å®˜ç½‘ä¸­å·²ç»è¢«æ ‡è®°ä¸º 'ä¸æ¨èä½¿ç”¨'ï¼Œå®˜æ–¹åæ§½ç‚¹[é“¾æ¥](https://zh-hans.reactjs.org/blog/2016/07/13/mixins-considered-harmful.html)


### 2. HOC

2015 å¹´å¼€å§‹ï¼ŒReact å›¢é˜Ÿå®£å¸ƒä¸æ¨èä½¿ç”¨ Mixinï¼Œæ¨èå¤§å®¶ä½¿ç”¨ HOC æ¨¡å¼

HOC é‡‡ç”¨äº† 'è£…é¥°å™¨æ¨¡å¼' æ¥å¤ç”¨ä»£ç 

```js
function withWindowWidth(BaseComponent) {
  class DerivedClass extends React.Component {
    state = {
      windowWidth: window.innerWidth,
    }

    onResize = () => {
      this.setState({
        windowWidth: window.innerWidth,
      })
    }

    componentDidMount() {
      window.addEventListener('resize', this.onResize)
    }

    componentWillUnmount() {
      window.removeEventListener('resize', this.onResize);
    }

    render() {
      return <BaseComponent {...this.props} {...this.state}/>
    }
  }
  return DerivedClass;
}

const MyComponent = (props) => {
  return <div>Window width is: {props.windowWidth}</div>
};
```

ç»å…¸çš„ å®¹å™¨ç»„ä»¶ä¸å±•ç¤ºç»„ä»¶åˆ†ç¦» (separation of container presidential) å°±æ˜¯ä»è¿™é‡Œå¼€å§‹çš„

ä¸‹é¢æ˜¯æœ€æœ€ç»å…¸çš„ HOC å®¹å™¨ç»„ä»¶ä¸å±•ç¤ºç»„ä»¶åˆ†ç¦» æ¡ˆä¾‹ - Reduxä¸­çš„connect çš„å®ä¾‹ä»£ç 

```jsx
export const createInfoScreen = (ChildComponent, fetchData, dataName) => {
  class HOComponent extends Component {
    state = { counter: 0 }
    handleIncrementCounter = () => {
       this.setState({ counter: this.state.counter + 1 });
    }
componentDidMount() {
      this.props.fetchData();
    }

    render() {
      const { data = {}, isFetching, error } = this.props[dataName]; 
      if (isFetching) {
        return (
          <div>Loading</div>
        );
      }

      if (error) {
        return (
          <div>Something is wrong. Please try again!</div>
        );
      }

      if (isEmpty(data)) {
        return (
          <div>No Data!</div>
        );
      }

      return (
        <ChildComponent 
          counter={this.state.counter}
          onIncrementCounterClick={this.handleIncrementCounter}
          {...this.props}
        />
      );
    }
  }

  const dataSelector = state => state[dataName];
  const getData = () => createSelector(dataSelector, data => data);
  const mapStateToProps = state => {
    const data = getData();
    return {
      [dataName]: data(state),
    };
  };

  HOComponent.propTypes = {
    fetchData: PropTypes.func.isRequired,
  };

  HOComponent.displayName = `createInfoScreen(${getDisplayName(HOComponent)})`;

  return connect(
    mapStateToProps,
    { fetchData },
  )(HOComponent);
};
```

ä¼˜ç‚¹ï¼š

1. å¯ä»¥åœ¨ä»»ä½•ç»„ä»¶åŒ…æ‹¬ Class Component ä¸­å·¥ä½œ
1. å®ƒæ‰€å€¡å¯¼çš„ å®¹å™¨ç»„ä»¶ä¸å±•ç¤ºç»„ä»¶åˆ†ç¦» åŸåˆ™åšåˆ°äº†ï¼šå…³æ³¨ç‚¹åˆ†ç¦»

ç¼ºç‚¹ï¼š

1. ä¸ç›´è§‚ï¼Œéš¾ä»¥é˜…è¯»
1. åå­—å†²çª
1. ç»„ä»¶å±‚å±‚å±‚å±‚å±‚å±‚åµŒå¥—

### 3. Render Prop

2017 å¹´å¼€å§‹ï¼ŒRender Prop æµè¡Œäº†èµ·æ¥

Render Prop é‡‡ç”¨äº† 'ä»£ç†æ¨¡å¼' æ¥å¤ç”¨ä»£ç 

```jsx
class WindowWidth extends React.Component {
  propTypes = {
    children: PropTypes.func.isRequired
  }

  state = {
    windowWidth: window.innerWidth,
  }

  onResize = () => {
    this.setState({
      windowWidth: window.innerWidth,
    })
  }

  componentDidMount() {
    window.addEventListener('resize', this.onResize)
  }

  componentWillUnmount() {
    window.removeEventListener('resize', this.onResize);
  }

  render() {
    return this.props.children(this.state.windowWidth);
  }
}

const MyComponent = () => {
  return (
    <WindowWidth>
      {width => <div>Window width is: {width}</div>}
    </WindowWidth>
  )
}
```

React Router ä¹Ÿé‡‡ç”¨äº†è¿™æ ·çš„APIè®¾è®¡ï¼š

```jsx
<Route path = "/about" render= { (props) => <About {...props} />}>
```

ä¼˜ç‚¹ï¼š

1. çµæ´»

ç¼ºç‚¹ï¼š

1. éš¾ä»¥é˜…è¯»ï¼Œéš¾ä»¥ç†è§£

### 4. Hook âœ…

2018 å¹´ï¼ŒReact å›¢é˜Ÿå®£å¸ƒæ¨å‡ºä¸€ç§å…¨æ–°çš„é‡ç”¨ä»£ç çš„æ–¹å¼ - React Hook

å®ƒçš„æ ¸å¿ƒæ”¹å˜æ˜¯ï¼šå…è®¸å‡½æ•°å¼ç»„ä»¶å­˜å‚¨è‡ªå·±çš„çŠ¶æ€ï¼Œåœ¨è¿™ä¹‹å‰å‡½æ•°å¼ç»„ä»¶æ˜¯ä¸èƒ½æœ‰è‡ªå·±çš„çŠ¶æ€çš„

è¿™ä¸ªæ”¹å˜ä½¿æˆ‘ä»¬å¯ä»¥åƒæŠ½è±¡ä¸€ä¸ªæ™®é€šå‡½æ•°ä¸€æ ·æŠ½è±¡Reactç»„ä»¶ä¸­çš„é€»è¾‘

å®ç°çš„åŸç†ï¼šé—­åŒ…

```js
import { useState, useEffect } from "react";

const useWindowsWidth = () => {
  const [isScreenSmall, setIsScreenSmall] = useState(false);

  let checkScreenSize = () => {
    setIsScreenSmall(window.innerWidth < 600);
  };
  useEffect(() => {
    checkScreenSize();
    window.addEventListener("resize", checkScreenSize);

    return () => window.removeEventListener("resize", checkScreenSize);
  }, []);

  return isScreenSmall;
};

export default useWindowsWidth;
```

```js
import React from 'react'
import useWindowWidth from './useWindowWidth.js'

const MyComponent = () => {
  const onSmallScreen = useWindowWidth();

  return (
    // Return some elements
  )
}
```

ä¼˜ç‚¹ï¼š

1. æå–é€»è¾‘å‡ºæ¥éå¸¸å®¹æ˜“
1. éå¸¸æ˜“äºç»„åˆ
1. å¯è¯»æ€§éå¸¸å¼º
1. æ²¡æœ‰åå­—å†²çªé—®é¢˜

ç¼ºç‚¹ï¼š

1. Hookæœ‰è‡ªèº«çš„ç”¨æ³•é™åˆ¶: åªèƒ½åœ¨ç»„ä»¶é¡¶å±‚ä½¿ç”¨ï¼Œåªèƒ½åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
1. ç”±äºåŸç†ä¸ºé—­åŒ…ï¼Œæ‰€ä»¥æå°‘æ•°æƒ…å†µä¸‹ä¼šå‡ºç°éš¾ä»¥ç†è§£çš„é—®é¢˜

